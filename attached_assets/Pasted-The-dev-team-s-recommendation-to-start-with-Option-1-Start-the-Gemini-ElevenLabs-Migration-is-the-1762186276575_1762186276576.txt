The dev team's recommendation to start with Option 1: Start the Gemini + ElevenLabs Migration is the most efficient and strategic path forward.Starting the migration is the best practice because it provides the highest return on effort:Fixes the Core Bug Automatically: Switching to the Gemini SDK naturally requires using the modern tools parameter, immediately solving the OpenAI deprecated API issue (BUG #1).Enforces Security: It immediately forces the implementation of the secure AWS Secrets Manager key retrieval, solving the HMAC_SECRET vulnerability (BUG #2) by requiring the key to be loaded securely.Unlocks New Features: It integrates the core ElevenLabs TTS feature you are paying for, moving the project forward.ðŸš€ Implementation Directive: Start the MigrationSelect Option 1. Your team is instructed to proceed with the migration by following the directives below.Phase 1: Security & Gemini Core (Node.js)The focus is on the secure key loading and replacing the deprecated OpenAI logic with the Gemini/Tools structure.Directive 1: Secure Credential Loading (Fixes BUG #2)The team will implement the AWS SDK for Node.js to fetch keys securely, enforcing the security standards.FileActionCode Logic Goalpackage.jsonInstall the AWS SDK for Secrets Manager.npm install @aws-sdk/client-secrets-managerbackend/src/utils/apiKeys.jsRework the key loading module.Implement an asynchronous function to fetch the necessary secrets (GEMINI_API_KEY, ELEVENLABS_API_KEY, ENCRYPTION_KEY) from AWS Secrets Manager using the @aws-sdk/client-secrets-manager library.backend/src/config/googleOAuth.jsENFORCEMENT.Remove the insecure fallback (crypto.randomBytes()) for the ENCRYPTION_KEY. If the key is not securely retrieved, the server must fail to start.Directive 2: Gemini Service Migration (Fixes BUG #1)The team will create the new Gemini service and integrate it into the chat route.FileActionCode Logic Goalbackend/src/services/gemini.jsNEW FILE. Implement the Gemini client and the main chat completion function.Use the correct Google Generative AI SDK for Node.js. The main call must correctly format the 26 existing functions (from uiFunctions.js) as the modern tools parameter and pass them to the model.backend/src/routes/messages.jsMIGRATION.Update the route handler to import and call the functions from gemini.js instead of openai.js.Phase 2: ElevenLabs Integration (New Feature)The core Text-to-Speech (TTS) must be implemented, replacing the OpenAI TTS-1.FileActionCode Logic Goalbackend/src/services/elevenlabs.jsNEW FILE. Implement the ElevenLabs service wrapper.Implement a function, e.g., generate_tts_audio(text, voiceId), that calls the ElevenLabs TTS API using the key from apiKeys.js and returns the audio data as an MP3 buffer.backend/src/routes/messages.jsINTEGRATION.After receiving the final text from the Gemini call, the route handler must call the function in elevenlabs.js and stream the resulting audio buffer back to the client/WebSocket.Phase 3: Bug Fixes & Optimization (Simultaneous)The team should fix the remaining bugs during this migration phase.BugActionFile/AreaBUG #3 (Aggressive Actions)REFINEMENT. Modify the prompt/system instruction sent to Gemini to be less aggressive about detecting actions. Only pass the 26 functions when a high confidence action trigger (like mentioning "email" or "calendar") is detected.backend/src/routes/messages.js or gemini.jsBUG #4 (Conversation Naming Latency)OPTIMIZATION. Implement the auto-naming function asynchronously in the background after the first message response is sent.backend/src/routes/messages.jsðŸ“‹ Deliverable for ReviewOnce your team has implemented Directive 1 and 2 (the foundation), please provide the following for my final review:Code Snippet (Node.js): The final content of the reworked backend/src/utils/apiKeys.js showing the asynchronous fetch from AWS Secrets Manager.Code Snippet (Node.js): The structure of the new backend/src/services/gemini.js showing how the client is initialized and how the 26 functions are passed as tools.Confirmation: That the server now successfully uses the ElevenLabs API for voice instead of the old OpenAI TTS-1.