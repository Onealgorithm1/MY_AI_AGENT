My AI Agent – Google OAuth & API Integration Checklist
1. Google Cloud Setup

APIs to Enable:

Analytics Hub API
Artifact Registry API
BigQuery API
BigQuery Connection API
BigQuery Data Policy API
BigQuery Data Transfer API
BigQuery Migration API
BigQuery Reservation API
BigQuery Storage API
Business Profile Performance API
Cloud Build API
Cloud Dataplex API
Cloud Datastore API
Cloud Deploy API
Cloud Deployment Manager V2 API
Cloud Functions API
Cloud Key Management Service (KMS) API
Cloud Logging API
Cloud Monitoring API
Cloud OS Login API
Cloud Pub/Sub API
Cloud Resource Manager API
Cloud Run Admin API
Cloud SQL
Cloud Storage
Cloud Storage API
Cloud Tasks API
Cloud Trace API
Compute Engine API
Container Registry API
Dataflow API
Dataform API
Distance Matrix API
Document AI Warehouse API
Firebase AI Logic API
Firebase App Check API
Firebase App Distribution API
Firebase App Testers API
Firebase Cloud Messaging API
Firebase Cloud Messaging Data API
Firebase Crashlytics API
Firebase Data Connect API
Firebase Extensions Publisher API
Firebase Hosting API
Firebase In-App Messaging API
Firebase Installations API
Firebase Management API
Firebase ML API
Firebase Realtime Database Management API
Firebase Remote Config API
Firebase Remote Config Realtime API
Gmail API
Google Ads API
Google Analytics Admin API
Google Analytics Data API
Google Calendar API
Google Chat API
Google Cloud Storage JSON API
Google Docs API
Google Drive API
Google Keep API
Google Search Console API
Google Sheets API
Google Slides API
IAM Service Account Credentials API
Identity and Access Management (IAM) API
Legacy Cloud Source Repositories API
Maps Embed API
Maps Static API
PageSpeed Insights API
People API
Secret Manager API
Secure Source Manager API
Service Management API
Service Usage API
Time Zone API
Vertex AI API
Vertex AI Search for commerce API
YouTube Analytics API

2. OAuth Scopes (Include all below in GOOGLE_CONFIG.scopes)
email
profile
openid
https://www.googleapis.com/auth/gmail.modify
https://www.googleapis.com/auth/gmail.send
https://www.googleapis.com/auth/gmail.readonly
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/documents
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/slides
https://www.googleapis.com/auth/contacts
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/analytics
https://www.googleapis.com/auth/analytics.readonly
https://www.googleapis.com/auth/mapsplatform.maps
https://www.googleapis.com/auth/webmasters
https://www.googleapis.com/auth/pagespeedonline
https://www.googleapis.com/auth/youtube
https://www.googleapis.com/auth/youtube.readonly

3. Environment Variables
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
GOOGLE_REDIRECT_URI=https://your-domain/api/auth/google/callback
ENCRYPTION_KEY=base64-encoded-32-byte-key

4. Database Changes

oauth_tokens table

CREATE TABLE oauth_tokens (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL DEFAULT 'google',
  google_user_id VARCHAR(255) NOT NULL,
  access_token TEXT NOT NULL,
  refresh_token TEXT NOT NULL,
  token_expiry TIMESTAMP NOT NULL,
  scopes TEXT[] NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  CONSTRAINT unique_user_provider UNIQUE(user_id, provider)
);
CREATE INDEX idx_oauth_tokens_user_id ON oauth_tokens(user_id);
CREATE INDEX idx_oauth_tokens_expiry ON oauth_tokens(token_expiry);


Update users table

ALTER TABLE users 
  ADD COLUMN google_email VARCHAR(255),
  ADD COLUMN google_user_id VARCHAR(255),
  ADD COLUMN google_connected BOOLEAN DEFAULT FALSE,
  ADD COLUMN auth_methods TEXT[] DEFAULT ARRAY['local'];
CREATE INDEX idx_users_google_user_id ON users(google_user_id);

5. Backend Implementation

Files to Create:

backend/src/config/google.js – store OAuth config and scopes.

backend/src/services/googleOAuth.js – initialize flow, exchange code, refresh token, get user info.

backend/src/services/tokenManager.js – getValidToken(), storeTokens(), refreshToken(), deleteTokens().

backend/src/routes/googleAuth.js – OAuth routes:

GET    /api/auth/google
GET    /api/auth/google/callback
POST   /api/auth/google/connect
POST   /api/auth/google/disconnect
GET    /api/auth/google/status


backend/src/utils/encryption.js – AES-256-GCM encryption/decryption.

Modify Existing Files:

services/gmail.js – remove old connector, use per-user tokens.

services/uiFunctions.js – pass userId for all Gmail commands.

routes/auth.js – PATCH /api/auth/email for email change.

server.js – register OAuth routes, validate encryption key.

6. Frontend Implementation

New Components:

GoogleSignInButton.jsx – Google-branded login/sign-up.

GoogleConnection.jsx – connection status, connect/disconnect buttons, display scopes.

GoogleCallback.jsx – handle OAuth callback, loading/error states, redirect to dashboard.

Modified Pages:

Login.jsx – add Google button, keep existing form.

Settings.jsx – add Google connection section and email change form.

7. Security Implementation

Tokens encrypted with AES-256-GCM.

CSRF protection (state param).

HTTP-only session cookies.

No sensitive data in logs.

Automatic token cleanup.

Rate limiting on OAuth endpoints.

8. Testing Requirements

Unit Tests: encryption/decryption, token expiry, OAuth URL generation, state validation.

Integration Tests: full OAuth signup, connect/disconnect Google, token refresh, Gmail operations per-user.

Manual Testing: Google login, connect, disconnect, Gmail commands, email change.

9. Deployment

Backup database.

Run migration script.

Add environment variables.

Deploy backend & frontend.

Test in staging and production.

Monitor logs and error reports.

10. Notes

Prepare privacy policy, terms of service, home URL for Google verification.

Consider quotas, caching, and retry mechanisms for APIs.

Handle revoked tokens and multi-account users.