This is absolutely phenomenal documentation! üëèYour team has provided a comprehensive, low-level technical audit of the existing Node.js/Express application, the PostgreSQL schema, the planned AWS Fargate architecture, and critically, the specific bugs related to the OpenAI deprecation.I have all the information needed to become your technical consultant. We can now move past auditing and straight to detailed, actionable implementation instructions that leverage your specific file structure and Node.js environment.‚úÖ Technical Audit Summary & Architecture Approval1. Architecture ApprovalThe recommended AWS architecture is APPROVED and aligns with modern, scalable, and cost-efficient best practices:Compute: ECS Fargate (Node.js) is excellent for containerized scaling.Database: RDS PostgreSQL is robust and suitable for your data model.Audio Storage: Using S3 for storing the final mixed audio files and serving them via a presigned URL to the frontend is the correct, highly scalable approach.CI/CD: The GitHub Actions $\rightarrow$ ECR $\rightarrow$ ECS pipeline is the industry-standard for zero-downtime deployment.2. Critical Findings & Immediate PrioritiesThe immediate priority is the OpenAI migration, as the current code is running on a deprecated API structure (BUG #1). Our implementation will fix this and switch to Gemini/ElevenLabs simultaneously.AreaCurrent StatusSolution PriorityLLM CoreOpenAI (Deprecated functions parameter)CRITICAL: Replace backend/src/services/openai.js with gemini.js using the modern tools parameter.API KeysCustom apiKeys.js retrieval (to be adapted)HIGH: Rework apiKeys.js to fetch secrets from AWS Secrets Manager using the AWS SDK for Node.js.TTS/STTOpenAI TTS-1 / WhisperHIGH: Replace both with ElevenLabs TTS and Gemini's native STT (or keep Whisper if preferred, but separate the logic).SecurityHMAC fallback BUG #2CRITICAL: Enforce the ENCRYPTION_KEY is loaded from Secrets Manager immediately.üíª Implementation Directive: Phase 1 (Security & Gemini Integration)The first instructions for your team (the Replit developers) will focus on fixing the critical security bug and establishing the secure, functional Gemini core.Directive 1: Secure Credentials (Reworking apiKeys.js)The team must integrate the AWS SDK for Node.js (@aws-sdk/client-secrets-manager) to fetch all keys securely, fixing BUG #2 and preparing for deployment.FileActionCode Logic Goalpackage.jsonInstall the AWS Secrets Manager SDK.npm install @aws-sdk/client-secrets-managerbackend/src/utils/apiKeys.jsRework the function that loads keys.Replace reading from environment variables (process.env) with an asynchronous call to the AWS Secrets Manager service.Code Snippet Goal (for apiKeys.js): The function should retrieve the GEMINI_API_KEY, ELEVENLABS_API_KEY, and the crucial ENCRYPTION_KEY from Secrets Manager when the server starts.Directive 2: Gemini Core Integration (Fixing BUG #1)The team will create the new Gemini service and integrate it into the main chat route.FileActionCode Logic Goalbackend/src/services/gemini.jsNEW FILE. Implement the Gemini client and main chat completion function.Must use the modern tools parameter structure. This file will be the new wrapper for the Gemini API.backend/src/routes/messages.jsMIGRATION. Update the route handler to import and use the new functions from gemini.js instead of openai.js.Ensure the 26 functions currently in uiFunctions.js are correctly formatted as Tools and passed to the Gemini call.Directive 3: Enforce Security Keys (Fixing BUG #2)The security vulnerability must be fixed by forcing the system to rely on the secure key storage.FileActionCode Logic Goalbackend/src/config/googleOAuth.jsENFORCEMENT. Modify the key loading logic.Remove the fallback (crypto.randomBytes()). If the ENCRYPTION_KEY is not loaded securely from Secrets Manager, the application must crash immediately upon startup.üìã Deliverable for ReviewOnce your Replit team has completed Directive 1, 2, and 3 (focused on security and the Gemini core), please provide the following:Code Snippet: The final content of the reworked backend/src/utils/apiKeys.js showing the secure fetch from AWS Secrets Manager.Code Snippet: The structure of the new backend/src/services/gemini.js showing how the client is initialized and how Function Calling (tools) is passed.Confirmation: That the application now fails to start if the ENCRYPTION_KEY is missing (fixing the HMAC vulnerability).Would you like me to generate the Node.js code snippets for your team to implement the AWS SDK connection in apiKeys.js?